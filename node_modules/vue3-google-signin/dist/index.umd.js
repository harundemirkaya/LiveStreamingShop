(function(a,n){typeof exports=="object"&&typeof module!="undefined"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(a=typeof globalThis!="undefined"?globalThis:a||self,n(a.GoogleOauth2Plugin={},a.Vue))})(this,function(a,n){"use strict";const m=Symbol(),I=n.ref(!1),y=n.ref(!1),G=n.ref(!1),T=n.ref(0);let b=null;const L=()=>{const t=document.createElement("script");return t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t},z=()=>{y.value=!0,b=L(),document.head.appendChild(b),b.onload=()=>{y.value=!1,I.value=!0},b.onerror=()=>{y.value=!1,G.value=!0}};n.watch(()=>T.value,(t,o)=>{t>0&&!I.value&&!y.value&&z()});function h(){return n.onMounted(()=>{T.value++}),n.onUnmounted(()=>{T.value--}),{scriptLoaded:n.readonly(I),scriptLoadError:n.readonly(G)}}const U=n.defineComponent({__name:"GoogleSignInButton",props:{oneTap:{type:Boolean},autoSelect:{type:Boolean},loginUri:null,cancelOnTapOutside:{type:Boolean},promptParentId:null,nonce:null,context:null,stateCookieDomain:null,uxMode:null,allowedParentOrigin:null,itpSupport:{type:Boolean},type:null,theme:null,size:null,text:null,shape:null,logoAlignment:null,width:null,locale:null},emits:["success","error","intermediateIframeCloseCallback","nativeCallback","promptMomentNotification"],setup(t,{emit:o}){const e=t,i={large:40,medium:32,small:20},l=n.inject(m),d=n.ref(null),{scriptLoaded:p}=h();n.watchEffect(()=>{var c,r,f,_;!p.value||((c=window.google)==null||c.accounts.id.initialize({client_id:l,callback:s=>{if(!s.clientId||!s.credential){o("error");return}o("success",s)},allowed_parent_origin:e.allowedParentOrigin,auto_select:e.autoSelect,cancel_on_tap_outside:e.cancelOnTapOutside,context:e.context,intermediate_iframe_close_callback:()=>{o("intermediateIframeCloseCallback")},itp_support:e.itpSupport,login_uri:e.loginUri,native_callback:s=>{o("nativeCallback",s)},nonce:e.nonce,prompt_parent_id:e.promptParentId,state_cookie_domain:e.stateCookieDomain,ux_mode:e.uxMode}),(f=window.google)==null||f.accounts.id.renderButton(d.value,{type:e.type,theme:e.theme,size:e.size,text:e.text,shape:e.shape,logo_alignment:e.logoAlignment,width:(r=e.width)==null?void 0:r.toString(),locale:e.locale}),e.oneTap&&((_=window.google)==null||_.accounts.id.prompt(s=>{o("promptMomentNotification",s)})))}),n.onUnmounted(()=>{var c;e.oneTap&&((c=window.google)==null||c.accounts.id.cancel())});const u=n.computed(()=>i[e.size||"large"]);return(c,r)=>(n.openBlock(),n.createElementBlock("div",{ref_key:"targetElement",ref:d,style:n.normalizeStyle({display:"inline-flex",height:n.unref(u)})},null,4))}});function B(t,o,...e){var i;return((i=window.google)==null?void 0:i.accounts.oauth2.hasGrantedAllScopes(t,o,...e))||!1}function q(t,o,...e){var i;return((i=window.google)==null?void 0:i.accounts.oauth2.hasGrantedAnyScope(t,o,...e))||!1}function $(t,o){var e;(e=window.google)==null||e.accounts.oauth2.revoke(t,()=>{o==null||o()})}function O(t){const o="https://accounts.google.com/o/oauth2/v2/auth",e=new URLSearchParams({gsiwebsdk:"3",client_id:t.client_id,scope:t.scope,include_granted_scopes:"true",access_type:"offline",response_type:"code",prompt:"consent"});return t.hint&&e.append("hint",t.hint),t.hosted_domain&&e.append("hosted_domain",t.hosted_domain),t.redirect_uri===void 0?e.append("redirect_uri",window.origin):e.append("redirect_uri",t.redirect_uri),t.select_account===void 0?e.append("select_account","false"):e.append("select_account",`${t.select_account}`),t.enable_serial_consent===void 0?e.append("enable_serial_consent","false"):e.append("enable_serial_consent",`${t.enable_serial_consent}`),t.state&&e.append("state",t.state),`${o}?${e.toString()}`}function M(t={}){const{scope:o="",onError:e,onSuccess:i,...l}=t,{scriptLoaded:d}=h(),p=n.inject(m),u=n.ref(!1),c=n.ref(null);let r;return n.watchEffect(()=>{var k;if(u.value=!1,!d.value)return;const f=n.unref(o),s=`openid email profile ${Array.isArray(f)?f.join(" "):f}`;c.value=O({client_id:p,scope:s,...l}),r=(k=window.google)==null?void 0:k.accounts.oauth2.initCodeClient({client_id:p,scope:s,callback:w=>{if(w.error)return e==null?void 0:e(w);i==null||i(w)},...l}),u.value=!0}),{isReady:n.readonly(u),login:()=>r==null?void 0:r.requestCode(),codeRequestRedirectUrl:n.readonly(c)}}function V(t){const{disableAutomaticPrompt:o=!1,onSuccess:e,onError:i,onPromptMomentNotification:l,onNativeCallback:d,onIntermediateIframeCloseCallback:p,autoSelect:u,loginUri:c,cancelOnTapOutside:r,promptParentId:f,nonce:_,context:s,stateCookieDomain:k,allowedParentOrigin:w,itpSupport:H}=t||{},{scriptLoaded:J}=h(),K=n.inject(m),C=n.ref(!1),F=()=>{var S;return C.value&&((S=window.google)==null?void 0:S.accounts.id.prompt(A=>l==null?void 0:l(A)))};return n.watchEffect(S=>{var j,E;if(C.value=!1,!J.value)return;const A=!n.unref(o),Q=n.unref(u),W=n.unref(c),X=n.unref(f),Y=n.unref(_),Z=n.unref(s),ee=n.unref(k),ne=n.unref(w),te=n.unref(H),oe=n.unref(r);(j=window.google)==null||j.accounts.id.initialize({client_id:K,callback:g=>{if(console.log("cb triggered"),!g.clientId||!g.credential){i==null||i();return}e==null||e(g)},native_callback:g=>{d==null||d(g)},intermediate_iframe_close_callback:()=>{p==null||p()},auto_select:Q,allowed_parent_origin:ne,context:Z,itp_support:te,login_uri:W,nonce:Y,prompt_parent_id:X,state_cookie_domain:ee,cancel_on_tap_outside:oe}),C.value=!0,A&&((E=window.google)==null||E.accounts.id.prompt(g=>l==null?void 0:l(g))),S(()=>{var g;(g=window.google)==null||g.accounts.id.cancel()})}),{isReady:n.readonly(C),login:F}}function x(t={}){const{scope:o="",onError:e,onSuccess:i,...l}=t,{scriptLoaded:d}=h(),p=n.inject(m),u=n.ref(!1);let c;return n.watchEffect(()=>{var _;if(u.value=!1,!d.value)return;const r=n.unref(o),f=Array.isArray(r)?r.join(" "):r;c=(_=window.google)==null?void 0:_.accounts.oauth2.initTokenClient({client_id:p,scope:`openid email profile ${f}`,callback:s=>{if(s.error)return e==null?void 0:e(s);i==null||i(s)},...l}),u.value=!0}),{isReady:n.readonly(u),login:r=>c==null?void 0:c.requestAccessToken(r)}}function D(t,o){var e;(e=window.google)==null||e.accounts.id.revoke(t,i=>{o==null||o(i)})}function N(t){const e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),i=decodeURIComponent(window.atob(e).split("").map(d=>`%${("00"+d.charCodeAt(0).toString(16)).slice(-2)}`).join("")),l=JSON.parse(i);return{email:l.email,email_verified:l.email_verified,hd:l.hd,family_name:l.family_name,given_name:l.given_name,name:l.name,picture:l.picture,id:l.sub}}const R="GoogleSignInPlugin",P=t=>`[${R}]: ${t}`,v={install(t,o){if(!o)throw new Error(P("initialize plugin by passing an options object"));if(!o.clientId||o.clientId&&o.clientId.trim().length===0)throw new Error(P("clientId is required to initialize"));t.provide(m,o.clientId),t.component("GoogleSignInButton",U)}};a.GoogleSignInButton=U,a.PLUGIN_NAME=R,a.buildCodeRequestRedirectUrl=O,a.decodeCredential=N,a.default=v,a.hasGrantedAllScopes=B,a.hasGrantedAnyScopes=q,a.idRevoke=D,a.revokeAccessToken=$,a.useCodeClient=M,a.useGsiScript=h,a.useOneTap=V,a.useTokenClient=x,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
