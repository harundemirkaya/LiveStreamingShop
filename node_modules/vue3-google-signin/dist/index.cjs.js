"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var t=require("vue");const m=Symbol(),I=t.ref(!1),k=t.ref(!1),G=t.ref(!1),S=t.ref(0);let b=null;const J=()=>{const n=document.createElement("script");return n.src="https://accounts.google.com/gsi/client",n.async=!0,n.defer=!0,n},K=()=>{k.value=!0,b=J(),document.head.appendChild(b),b.onload=()=>{k.value=!1,I.value=!0},b.onerror=()=>{k.value=!1,G.value=!0}};t.watch(()=>S.value,(n,o)=>{n>0&&!I.value&&!k.value&&K()});function h(){return t.onMounted(()=>{S.value++}),t.onUnmounted(()=>{S.value--}),{scriptLoaded:t.readonly(I),scriptLoadError:t.readonly(G)}}const x=t.defineComponent({__name:"GoogleSignInButton",props:{oneTap:{type:Boolean},autoSelect:{type:Boolean},loginUri:null,cancelOnTapOutside:{type:Boolean},promptParentId:null,nonce:null,context:null,stateCookieDomain:null,uxMode:null,allowedParentOrigin:null,itpSupport:{type:Boolean},type:null,theme:null,size:null,text:null,shape:null,logoAlignment:null,width:null,locale:null},emits:["success","error","intermediateIframeCloseCallback","nativeCallback","promptMomentNotification"],setup(n,{emit:o}){const e=n,l={large:40,medium:32,small:20},i=t.inject(m),s=t.ref(null),{scriptLoaded:d}=h();t.watchEffect(()=>{var a,c,p,g;!d.value||((a=window.google)==null||a.accounts.id.initialize({client_id:i,callback:r=>{if(!r.clientId||!r.credential){o("error");return}o("success",r)},allowed_parent_origin:e.allowedParentOrigin,auto_select:e.autoSelect,cancel_on_tap_outside:e.cancelOnTapOutside,context:e.context,intermediate_iframe_close_callback:()=>{o("intermediateIframeCloseCallback")},itp_support:e.itpSupport,login_uri:e.loginUri,native_callback:r=>{o("nativeCallback",r)},nonce:e.nonce,prompt_parent_id:e.promptParentId,state_cookie_domain:e.stateCookieDomain,ux_mode:e.uxMode}),(p=window.google)==null||p.accounts.id.renderButton(s.value,{type:e.type,theme:e.theme,size:e.size,text:e.text,shape:e.shape,logo_alignment:e.logoAlignment,width:(c=e.width)==null?void 0:c.toString(),locale:e.locale}),e.oneTap&&((g=window.google)==null||g.accounts.id.prompt(r=>{o("promptMomentNotification",r)})))}),t.onUnmounted(()=>{var a;e.oneTap&&((a=window.google)==null||a.accounts.id.cancel())});const u=t.computed(()=>l[e.size||"large"]);return(a,c)=>(t.openBlock(),t.createElementBlock("div",{ref_key:"targetElement",ref:s,style:t.normalizeStyle({display:"inline-flex",height:t.unref(u)})},null,4))}});function F(n,o,...e){var l;return((l=window.google)==null?void 0:l.accounts.oauth2.hasGrantedAllScopes(n,o,...e))||!1}function Q(n,o,...e){var l;return((l=window.google)==null?void 0:l.accounts.oauth2.hasGrantedAnyScope(n,o,...e))||!1}function W(n,o){var e;(e=window.google)==null||e.accounts.oauth2.revoke(n,()=>{o==null||o()})}function R(n){const o="https://accounts.google.com/o/oauth2/v2/auth",e=new URLSearchParams({gsiwebsdk:"3",client_id:n.client_id,scope:n.scope,include_granted_scopes:"true",access_type:"offline",response_type:"code",prompt:"consent"});return n.hint&&e.append("hint",n.hint),n.hosted_domain&&e.append("hosted_domain",n.hosted_domain),n.redirect_uri===void 0?e.append("redirect_uri",window.origin):e.append("redirect_uri",n.redirect_uri),n.select_account===void 0?e.append("select_account","false"):e.append("select_account",`${n.select_account}`),n.enable_serial_consent===void 0?e.append("enable_serial_consent","false"):e.append("enable_serial_consent",`${n.enable_serial_consent}`),n.state&&e.append("state",n.state),`${o}?${e.toString()}`}function X(n={}){const{scope:o="",onError:e,onSuccess:l,...i}=n,{scriptLoaded:s}=h(),d=t.inject(m),u=t.ref(!1),a=t.ref(null);let c;return t.watchEffect(()=>{var w;if(u.value=!1,!s.value)return;const p=t.unref(o),r=`openid email profile ${Array.isArray(p)?p.join(" "):p}`;a.value=R({client_id:d,scope:r,...i}),c=(w=window.google)==null?void 0:w.accounts.oauth2.initCodeClient({client_id:d,scope:r,callback:_=>{if(_.error)return e==null?void 0:e(_);l==null||l(_)},...i}),u.value=!0}),{isReady:t.readonly(u),login:()=>c==null?void 0:c.requestCode(),codeRequestRedirectUrl:t.readonly(a)}}function Y(n){const{disableAutomaticPrompt:o=!1,onSuccess:e,onError:l,onPromptMomentNotification:i,onNativeCallback:s,onIntermediateIframeCloseCallback:d,autoSelect:u,loginUri:a,cancelOnTapOutside:c,promptParentId:p,nonce:g,context:r,stateCookieDomain:w,allowedParentOrigin:_,itpSupport:P}=n||{},{scriptLoaded:E}=h(),L=t.inject(m),v=t.ref(!1),j=()=>{var y;return v.value&&((y=window.google)==null?void 0:y.accounts.id.prompt(C=>i==null?void 0:i(C)))};return t.watchEffect(y=>{var A,T;if(v.value=!1,!E.value)return;const C=!t.unref(o),z=t.unref(u),B=t.unref(a),q=t.unref(p),$=t.unref(g),M=t.unref(r),V=t.unref(w),D=t.unref(_),N=t.unref(P),H=t.unref(c);(A=window.google)==null||A.accounts.id.initialize({client_id:L,callback:f=>{if(console.log("cb triggered"),!f.clientId||!f.credential){l==null||l();return}e==null||e(f)},native_callback:f=>{s==null||s(f)},intermediate_iframe_close_callback:()=>{d==null||d()},auto_select:z,allowed_parent_origin:D,context:M,itp_support:N,login_uri:B,nonce:$,prompt_parent_id:q,state_cookie_domain:V,cancel_on_tap_outside:H}),v.value=!0,C&&((T=window.google)==null||T.accounts.id.prompt(f=>i==null?void 0:i(f))),y(()=>{var f;(f=window.google)==null||f.accounts.id.cancel()})}),{isReady:t.readonly(v),login:j}}function Z(n={}){const{scope:o="",onError:e,onSuccess:l,...i}=n,{scriptLoaded:s}=h(),d=t.inject(m),u=t.ref(!1);let a;return t.watchEffect(()=>{var g;if(u.value=!1,!s.value)return;const c=t.unref(o),p=Array.isArray(c)?c.join(" "):c;a=(g=window.google)==null?void 0:g.accounts.oauth2.initTokenClient({client_id:d,scope:`openid email profile ${p}`,callback:r=>{if(r.error)return e==null?void 0:e(r);l==null||l(r)},...i}),u.value=!0}),{isReady:t.readonly(u),login:c=>a==null?void 0:a.requestAccessToken(c)}}function ee(n,o){var e;(e=window.google)==null||e.accounts.id.revoke(n,l=>{o==null||o(l)})}function te(n){const e=n.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),l=decodeURIComponent(window.atob(e).split("").map(s=>`%${("00"+s.charCodeAt(0).toString(16)).slice(-2)}`).join("")),i=JSON.parse(l);return{email:i.email,email_verified:i.email_verified,hd:i.hd,family_name:i.family_name,given_name:i.given_name,name:i.name,picture:i.picture,id:i.sub}}const O="GoogleSignInPlugin",U=n=>`[${O}]: ${n}`,ne={install(n,o){if(!o)throw new Error(U("initialize plugin by passing an options object"));if(!o.clientId||o.clientId&&o.clientId.trim().length===0)throw new Error(U("clientId is required to initialize"));n.provide(m,o.clientId),n.component("GoogleSignInButton",x)}};exports.GoogleSignInButton=x;exports.PLUGIN_NAME=O;exports.buildCodeRequestRedirectUrl=R;exports.decodeCredential=te;exports.default=ne;exports.hasGrantedAllScopes=F;exports.hasGrantedAnyScopes=Q;exports.idRevoke=ee;exports.revokeAccessToken=W;exports.useCodeClient=X;exports.useGsiScript=h;exports.useOneTap=Y;exports.useTokenClient=Z;
